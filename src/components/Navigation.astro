---
import { Image } from 'astro:assets';
import instagramIcon from '../assets/instagram.svg';
import linkedinIcon from '../assets/linkedin.svg';
---
<nav class="nav-bar">
  <div class="nav-container">
    <div class="flex justify-between h-16">
      <div class="flex">
        <div class="flex-shrink-0 flex items-center">
          <a href="/" class="nav-logo">EMMA</a>
        </div>
        <div class="hidden sm:ml-6 sm:flex sm:space-x-8 items-center">
          <a href="/" class="nav-link">
            Home / Trips
          </a>
          <a href="/my-work" class="nav-link">
            My Work
          </a>
          <a href="/about" class="nav-link">
            About
          </a>
          <a href="/contact" class="nav-link">
            Contact
          </a>
        </div>
      </div>
      
      <div class="hidden sm:flex sm:items-center sm:ml-6 space-x-6">
        <!-- Day/Night Toggle -->
        <div class="flex items-center space-x-2">
            <span class="text-xs font-medium text-text-muted">Day</span>
            <label for="nav-theme-toggle" class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" id="nav-theme-toggle" class="sr-only peer">
            <div class="w-10 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-accent-primary dark:peer-focus:ring-accent-primary rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-accent-primary"></div>
            </label>
            <span class="text-xs font-medium text-text-muted">Night</span>
        </div>

        <!-- Social Icons (Desktop) -->
        <div class="flex items-center space-x-4">
            <a href="#" class="nav-icon">
            <span class="sr-only">Instagram</span>
            <Image src={instagramIcon} alt="Instagram" class="h-6 w-6" />
            </a>

            <a href="#" class="nav-icon">
            <span class="sr-only">LinkedIn</span>
            <Image src={linkedinIcon} alt="LinkedIn" class="h-6 w-6" />
            </a>
        </div>
      </div>

      <!-- Mobile menu button placeholder (simple version) -->
      <div class="-mr-2 flex items-center sm:hidden">
        <button type="button" class="bg-bg-surface inline-flex items-center justify-center p-2 rounded-md text-text-muted hover:text-text-main hover:bg-bg-surface-alt focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-primary" aria-controls="mobile-menu" aria-expanded="false">
          <span class="sr-only">Open main menu</span>
          <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu (Hidden by default, simple implementation for now) -->
  <div class="sm:hidden hidden nav-mobile-menu" id="mobile-menu">
    <div class="pt-2 pb-3 space-y-1">
      <a href="/" class="bg-indigo-50 dark:bg-gray-700 border-accent-primary text-accent-primary block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Home</a>
      <a href="/my-work" class="nav-link-mobile">My Work</a>
      <a href="/about" class="nav-link-mobile">About</a>
      <a href="/contact" class="nav-link-mobile">Contact</a>
    </div>
    <div class="pt-4 pb-4 border-t border-gray-200 dark:border-gray-700">
      <div class="flex items-center px-4 space-x-4">
        <!-- Mobile Theme Toggle -->
        <div class="flex items-center space-x-2">
           <span class="text-xs font-medium text-text-muted">Day</span>
            <label for="mobile-theme-toggle" class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" id="mobile-theme-toggle" class="sr-only peer">
            <div class="w-10 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-accent-primary dark:peer-focus:ring-accent-primary rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-accent-primary"></div>
            </label>
           <span class="text-xs font-medium text-text-muted">Night</span>
        </div>
      </div>
       <div class="mt-3 px-4 flex items-center space-x-4">
            <a href="#" class="text-text-muted hover:text-text-main">
            <span class="sr-only">Instagram</span>
            <Image src={instagramIcon} alt="Instagram" class="h-6 w-6" />
            </a>

            <a href="#" class="text-text-muted hover:text-text-main">
            <span class="sr-only">LinkedIn</span>
            <Image src={linkedinIcon} alt="LinkedIn" class="h-6 w-6" />
            </a>
      </div>
    </div>
  </div>
</nav>

<script>
  function setupNavigation() {
    // Simple toggle for mobile menu
    const btn = document.querySelector('button[aria-controls="mobile-menu"]');
    const menu = document.getElementById('mobile-menu');

    if (btn && menu) {
      // Remove old listener if any (though usually fresh elements)
      const newBtn = btn.cloneNode(true);
      if (btn.parentNode) {
        btn.parentNode.replaceChild(newBtn, btn);
      }
      
      newBtn.addEventListener('click', () => {
        const expanded = newBtn.getAttribute('aria-expanded') === 'true' || false;
        newBtn.setAttribute('aria-expanded', (!expanded).toString());
        menu.classList.toggle('hidden');
      });
    }

    // Theme Toggle Logic
    const themeToggle = document.getElementById('nav-theme-toggle') as HTMLInputElement;
    const mobileThemeToggle = document.getElementById('mobile-theme-toggle') as HTMLInputElement;
    
    // Function to apply theme
    const applyTheme = (isDark: boolean) => {
        if (isDark) {
            document.documentElement.classList.add('dark');
            if (themeToggle) themeToggle.checked = true;
            if (mobileThemeToggle) mobileThemeToggle.checked = true;
        } else {
            document.documentElement.classList.remove('dark');
            if (themeToggle) themeToggle.checked = false;
            if (mobileThemeToggle) mobileThemeToggle.checked = false;
        }
    };

    // Initialize state
    const savedTheme = localStorage.getItem('theme');
    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const isDark = savedTheme === 'dark' || (!savedTheme && systemDark);
    
    applyTheme(isDark);

    // Event Listener Helper
    const handleThemeChange = (isChecked: boolean) => {
         if (isChecked) {
            document.documentElement.classList.add('dark');
            localStorage.setItem('theme', 'dark');
            window.dispatchEvent(new CustomEvent('theme-change', { detail: { theme: 'dark' } }));
             if (themeToggle) themeToggle.checked = true;
             if (mobileThemeToggle) mobileThemeToggle.checked = true;
        } else {
            document.documentElement.classList.remove('dark');
            localStorage.setItem('theme', 'light');
            window.dispatchEvent(new CustomEvent('theme-change', { detail: { theme: 'light' } }));
             if (themeToggle) themeToggle.checked = false;
             if (mobileThemeToggle) mobileThemeToggle.checked = false;
        }
    };

    if (themeToggle) {
        themeToggle.addEventListener('change', () => handleThemeChange(themeToggle.checked));
    }

    if (mobileThemeToggle) {
        mobileThemeToggle.addEventListener('change', () => handleThemeChange(mobileThemeToggle.checked));
    }
  }

  // Run on initial load
  setupNavigation();

  // Run on view transitions
  document.addEventListener('astro:after-swap', setupNavigation);
</script>